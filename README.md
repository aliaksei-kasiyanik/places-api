# Places API

## Архитектура системы

### Прикладная область

  Чтобы определить гарантии, которые Places API должен обеспечивать, сначала определим область применения данного веб-сервиса.
Предполагается, что данный веб-сервис в первую очередь будет использоваться приложениями-планировщиками туристических путешествий. 

  Приложение, использующее Places API, будет позволять пользователям осуществлять поиск POI в некоторой области по заданным координатам геолокации и создавать списки/коллекции мест, которые он хотел бы посетить. 
  
  Для наполнения существующей базы данных POI пользователь может сам добавлять места (POI), которых нет в базе. Такие места станут видны другим пользователям после проверки и утверждения администратором.
  
  Также пользователь может оставлять комментарии относительно POI и оценивать POI методом "thumbs-up/thumbs-down". Также предполагается возможность загрузки фотографий POI пользователем. 
  
  Пользователь может вносить/предлагать изменения в информацию о POI, которые будут применяться только после модерации администратором в целях защиты от вандализма, например, вредительского добавления, удаления или изменения содержания. 

 **Note!** Реализация REST API для приведенного выше функционала может занять большое количество времени, поэтому в рамках курса будет реализован базовый API по работе c POI (см. https://aliaksei-kasiyanik.github.io/), однако изначальная архитектура будет строиться таким образом, чтобы реализация всего функционала или его расширение происходила без критических изменений в архитектуре.
 
 Places API рассматривается как высоконагруженный веб-сервис, способный быстро отвечать на запросы, приходящие из любой точки мира.

### CAP Theorem

  Учитывая особенности распреденных систем, рассматриваемых CAP теоремой (https://en.wikipedia.org/wiki/CAP_theorem), определим каким гарантиям наша система должна соответствовать в терминах CAP теоремы, основываясь на бизнесс-логике и области применения данного веб-сервиса. 

  В первую очередь последовательно рассмотрим базовый функционал (см. https://aliaksei-kasiyanik.github.io/) с точки зрения CAP теоремы:
* /places GET - поиск POI в заданном регионе; возвращает список POI.
  Нам необходима высокая доступность данного ресурса (availability), т.к. он является ключевым в нашем сервисе. При этом ресурс требует только доступность на чтение. Устойчивость к разделению  сети (partition tolerance) также необходима в данном случае: если, например, Ктулху перегрызет межконтинентальный кабель между Европой и Америкой на дне Атлантического океана, данный ресурс должен продолжать отвечать и в Европе, и в Америке. Консистентность данных здесь не так критична, так как ее нарушение не блокирует работу и не влечет критических последствий в текущий момент времени.
  Таким образом нам нужны гарантии **AP (A - на чтение)**.
  
* /places/{id} GET - возвращает полную информация о конкретном POI
 То же как и для /places GET. **AP (A - на чтение)**
  
* /places POST - добавление новых POI; данный ресурс доступен только администраторам.
  Функция добавления нового POI не критична с точки зрения availability, так как не доступна обычным пользователям и никаким образом не влияет на его работу, а администратор будет осведомлен о проблемах доступности данного ресурса и сможет добавить POI позже после восстановления системы. С точки зрения consistency нам важно, чтобы после применения данной операции POI был виден со всех узлов, иначе возможна ситуация, когда запрос поиска попадет на один узел, на котором POI уже добавлен, а следующий запрос на получение полной информации (например, с комментариями и фотографиями) попадет на узел, где данного POI еще нет.
  То есть получаем - **СP**.  

* /places/{id} PUT - модификация существующего POI; данный ресурс доступен только администраторам.
  Обновление информации о POI не имеет особо влияния на работу пользователя, поэтому строгая консистентность не нужна, однако ожидается, что информация о POI гарантировано будет консистентной через некоторый промежуток времени. Availability можно пожертвовать по тем же причинам, что и в /places POST, поэтому нам подойдет **СP (C - eventual)**.

* /places/{id} DELETE - удаление новых POI; данный ресурс доступен только администраторам.
  Те же соображения, как и для /places/{id} PUT.
  **СP (C - eventual)**
  
  
  *Рассмотрим функционал, который не планируется реализовывать в учебном проекте (хотя вероятность есть):*

* /places/{id}/comment POST - добавление комментария к POI;  комментарии предоставляются вместе с другой информацией о POI c помощью /places/{id} GET
  Необходимо гарантировать, что добавленные пользователем комментарии должны быть сразу видны пользователем, который их добавил. Также необходима eventual consistency, чтобы другие пользователи в конечном счете увидели комментарии других пользователей. Также важно availability, так как мнение пользователей важно и интересно другим пользователям и имеет часто определяющее значение при выборе посетить данное место или нет. 
  Поэтому здесь желательно **AP c eventual consistency**.

* /places/{id}/vote PUT - голосование "thumbs-up/thumbs-down"
  В общем те же соображения как и для добавления комментариев. **AP c eventual consistency**

* /places/{id}/image POST - добавление фотографии; добавленные фотографии возвращаются вместе с другой информацией о POI c помощью /places/{id} GET
  Те же соображения как и для добавления комментариев. **AP c eventual consistency**
  
* /new-places POST - добавление новых POI пользователем в общую базу; POI в базу сразу не попадают, а проходят модерацию администратором
  Если рассмотреть возможность добавления точек любым пользователем, то важна availability, а не consistency, так как новый POI станет общедоступным только после проверки администратором, а для этого в любом случае нужно время. **AP c eventual consistency** 
  
  
#### Обобщение
 Исходя из соображений выше, нам лучше всего подходит AP система c eventual consistency, а для администраторского функционала нужны CP гарантии. 
 
